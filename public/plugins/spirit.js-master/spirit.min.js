/*!
 * SpiritJS 1.0.3 (http://spiritjs.io/)
 * Copyright 2013 - 2016 Inlet.
 * Licensed under Apache 2.0 (https://github.com/inlet/spirit.js/blob/master/LICENSE)
 */
! function(global) {
    var context = {
            spirit: {
                VERSION: "1.0.3"
            }
        },
        contextInternally = {},
        use = function(t, e) {
            for (var n = t.split("."), r = 0, i = n.length, a = e ? context : contextInternally; i > r; ++r) {
                var s = n[r];
                a[s] || (a[s] = {}), a = a[s]
            }
            return a
        },
        exist = function(t, e) {
            if ("string" != typeof t) return !1;
            for (var n = t.split("."), r = !0, i = 0, a = n.length, s = e ? context : contextInternally; a > i; ++i) {
                var o = n[i];
                if (!s[o]) {
                    r = !1;
                    break
                }
                s = s[o]
            }
            return r
        };
    ! function(t) {
        (function() {
            function e(t, e, n) {
                for (var r = (n || 0) - 1, i = t ? t.length : 0; ++r < i;)
                    if (t[r] === e) return r;
                return -1
            }

            function n(t, e) {
                var n = t.criteria,
                    r = e.criteria;
                if (n !== r) {
                    if (n > r || "undefined" == typeof n) return 1;
                    if (r > n || "undefined" == typeof r) return -1
                }
                return t.index - e.index
            }

            function r(t) {
                return "\\" + yn[t]
            }

            function i() {}

            function a(t) {
                return t instanceof a ? t : new s(t)
            }

            function s(t, e) {
                this.__chain__ = !!e, this.__wrapped__ = t
            }

            function o(t, e, n) {
                if ("function" != typeof t) return Pe;
                if ("undefined" == typeof e) return t;
                switch (n) {
                    case 1:
                        return function(n) {
                            return t.call(e, n)
                        };
                    case 2:
                        return function(n, r) {
                            return t.call(e, n, r)
                        };
                    case 3:
                        return function(n, r, i) {
                            return t.call(e, n, r, i)
                        };
                    case 4:
                        return function(n, r, i, a) {
                            return t.call(e, n, r, i, a)
                        }
                }
                return Se(t, e)
            }

            function u(t, e, n, r) {
                for (var i = (r || 0) - 1, a = t ? t.length : 0, s = []; ++i < a;) {
                    var o = t[i];
                    if (o && "object" == typeof o && "number" == typeof o.length && (Vn(o) || v(o))) {
                        e || (o = u(o, e, n));
                        var l = -1,
                            c = o.length,
                            f = s.length;
                        for (s.length += c; ++l < c;) s[f++] = o[l]
                    } else n || s.push(o)
                }
                return s
            }

            function l(t, e, n, r) {
                if (t === e) return 0 !== t || 1 / t == 1 / e;
                var i = typeof t,
                    s = typeof e;
                if (!(t !== t || t && vn[i] || e && vn[s])) return !1;
                if (null == t || null == e) return t === e;
                var o = Rn.call(t),
                    u = Rn.call(e);
                if (o != u) return !1;
                switch (o) {
                    case cn:
                    case fn:
                        return +t == +e;
                    case hn:
                        return t != +t ? e != +e : 0 == t ? 1 / t == 1 / e : t == +e;
                    case dn:
                    case gn:
                        return t == String(e)
                }
                var c = o == ln;
                if (!c) {
                    if (kn.call(t, "__wrapped__ ") || e instanceof a) return l(t.__wrapped__ || t, e.__wrapped__ || e, n, r);
                    if (o != mn) return !1;
                    var f = t.constructor,
                        p = e.constructor;
                    if (f != p && !(M(f) && f instanceof f && M(p) && p instanceof p)) return !1
                }
                n || (n = []), r || (r = []);
                for (var h = n.length; h--;)
                    if (n[h] == t) return r[h] == e;
                var m = !0,
                    d = 0;
                if (n.push(t), r.push(e), c) {
                    if (d = e.length, m = d == t.length)
                        for (; d-- && (m = l(t[d], e[d], n, r)););
                    return m
                }
                return tr(e, function(e, i, a) {
                    return kn.call(a, i) ? (d++, !(m = kn.call(t, i) && l(t[i], e, n, r)) && nn) : void 0
                }), m && tr(t, function(t, e, n) {
                    return kn.call(n, e) ? !(m = --d > -1) && nn : void 0
                }), m
            }

            function c(t, e, n) {
                for (var r = -1, i = d(), a = t ? t.length : 0, s = [], o = n ? [] : s; ++r < a;) {
                    var u = t[r],
                        l = n ? n(u, r, t) : u;
                    (e ? !r || o[o.length - 1] !== l : i(o, l) < 0) && (n && o.push(l), s.push(u))
                }
                return s
            }

            function f(t) {
                return function(e, n, r) {
                    var i = {};
                    n = Ne(n, r, 3);
                    var a = -1,
                        s = e ? e.length : 0;
                    if ("number" == typeof s)
                        for (; ++a < s;) {
                            var o = e[a];
                            t(i, o, n(o, a, e), e)
                        } else er(e, function(e, r, a) {
                            t(i, e, n(e, r, a), a)
                        });
                    return i
                }
            }

            function p(t, e, n, r, i, a) {
                var s = 1 & e,
                    o = 2 & e,
                    u = 4 & e,
                    l = 8 & e,
                    c = 16 & e,
                    f = 32 & e,
                    m = t;
                if (!o && !M(t)) throw new TypeError;
                if (c && !n.length && (e &= -17, c = n = !1), f && !r.length && (e &= -33, f = r = !1), s && !(o || u || f) && (Yn.fastBind || Bn && c)) {
                    if (c) {
                        var d = [i];
                        Nn.apply(d, n)
                    }
                    var g = c ? Bn.apply(t, d) : Bn.call(t, i)
                } else g = function() {
                    var d = arguments,
                        v = s ? i : this;
                    if ((u || c || f) && (d = Wn.call(d), c && In.apply(d, n), f && Nn.apply(d, r), u && d.length < a)) return e |= 16, p(t, l ? e : -4 & e, d, null, i, a);
                    if (o && (t = v[m]), this instanceof g) {
                        v = h(t.prototype);
                        var y = t.apply(v, d);
                        return N(y) ? y : v
                    }
                    return t.apply(v, d)
                };
                return g
            }

            function h(t) {
                return N(t) ? zn(t) : {}
            }

            function m(t) {
                return Qn[t]
            }

            function d() {
                var t = (t = a.indexOf) === me ? e : t;
                return t
            }

            function g(t) {
                return Zn[t]
            }

            function v(t) {
                return t && "object" == typeof t && "number" == typeof t.length && Rn.call(t) == un || !1
            }

            function y(t) {
                if (!t) return t;
                for (var e = 1, n = arguments.length; n > e; e++) {
                    var r = arguments[e];
                    if (r)
                        for (var i in r) t[i] = r[i]
                }
                return t
            }

            function _(t) {
                return N(t) ? Vn(t) ? Wn.call(t) : y({}, t) : t
            }

            function b(t) {
                if (!t) return t;
                for (var e = 1, n = arguments.length; n > e; e++) {
                    var r = arguments[e];
                    if (r)
                        for (var i in r) "undefined" == typeof t[i] && (t[i] = r[i])
                }
                return t
            }

            function x(t) {
                var e = [];
                return tr(t, function(t, n) {
                    M(t) && e.push(n)
                }), e.sort()
            }

            function w(t, e) {
                return t ? kn.call(t, e) : !1
            }

            function T(t) {
                for (var e = -1, n = Gn(t), r = n.length, i = {}; ++e < r;) {
                    var a = n[e];
                    i[t[a]] = a
                }
                return i
            }

            function A(t) {
                return t === !0 || t === !1 || Rn.call(t) == cn
            }

            function E(t) {
                return t ? "object" == typeof t && Rn.call(t) == fn : !1
            }

            function j(t) {
                return t ? 1 === t.nodeType : !1
            }

            function O(t) {
                if (!t) return !0;
                if (Vn(t) || C(t)) return !t.length;
                for (var e in t)
                    if (kn.call(t, e)) return !1;
                return !0
            }

            function S(t, e) {
                return l(t, e)
            }

            function k(t) {
                return Dn(t) && !Fn(parseFloat(t))
            }

            function M(t) {
                return "function" == typeof t
            }

            function N(t) {
                return !(!t || !vn[typeof t])
            }

            function R(t) {
                return B(t) && t != +t
            }

            function I(t) {
                return null === t
            }

            function B(t) {
                return "number" == typeof t || Rn.call(t) == hn
            }

            function z(t) {
                return t && vn[typeof t] ? Rn.call(t) == dn : !1
            }

            function C(t) {
                return "string" == typeof t || Rn.call(t) == gn
            }

            function D(t) {
                return "undefined" == typeof t
            }

            function F(t) {
                var e = d(),
                    n = u(arguments, !0, !1, 1),
                    r = {};
                return tr(t, function(t, i) {
                    e(n, i) < 0 && (r[i] = t)
                }), r
            }

            function L(t) {
                for (var e = -1, n = Gn(t), r = n.length, i = Array(r); ++e < r;) {
                    var a = n[e];
                    i[e] = [a, t[a]]
                }
                return i
            }

            function $(t) {
                for (var e = -1, n = u(arguments, !0, !1, 1), r = n.length, i = {}; ++e < r;) {
                    var a = n[e];
                    a in t && (i[a] = t[a])
                }
                return i
            }

            function P(t) {
                for (var e = -1, n = Gn(t), r = n.length, i = Array(r); ++e < r;) i[e] = t[n[e]];
                return i
            }

            function J(t, e) {
                var n = d(),
                    r = t ? t.length : 0,
                    i = !1;
                return r && "number" == typeof r ? i = n(t, e) > -1 : er(t, function(t) {
                    return (i = t === e) && nn
                }), i
            }

            function W(t, e, n) {
                var r = !0;
                e = Ne(e, n, 3);
                var i = -1,
                    a = t ? t.length : 0;
                if ("number" == typeof a)
                    for (; ++i < a && (r = !!e(t[i], i, t)););
                else er(t, function(t, n, i) {
                    return !(r = !!e(t, n, i)) && nn
                });
                return r
            }

            function q(t, e, n) {
                var r = [];
                e = Ne(e, n, 3);
                var i = -1,
                    a = t ? t.length : 0;
                if ("number" == typeof a)
                    for (; ++i < a;) {
                        var s = t[i];
                        e(s, i, t) && r.push(s)
                    } else er(t, function(t, n, i) {
                        e(t, n, i) && r.push(t)
                    });
                return r
            }

            function X(t, e, n) {
                e = Ne(e, n, 3);
                var r = -1,
                    i = t ? t.length : 0;
                if ("number" != typeof i) {
                    var a;
                    return er(t, function(t, n, r) {
                        return e(t, n, r) ? (a = t, nn) : void 0
                    }), a
                }
                for (; ++r < i;) {
                    var s = t[r];
                    if (e(s, r, t)) return s
                }
            }

            function Y(t, e) {
                return le(t, e, !0)
            }

            function V(t, e, n) {
                var r = -1,
                    i = t ? t.length : 0;
                if (e = e && "undefined" == typeof n ? e : o(e, n, 3), "number" == typeof i)
                    for (; ++r < i && e(t[r], r, t) !== nn;);
                else er(t, e)
            }

            function U(t, e) {
                var n = t ? t.length : 0;
                if ("number" == typeof n)
                    for (; n-- && e(t[n], n, t) !== !1;);
                else {
                    var r = Gn(t);
                    n = r.length, er(t, function(t, i, a) {
                        return i = r ? r[--n] : --n, e(a[i], i, a) === !1 && nn
                    })
                }
            }

            function G(t, e) {
                var n = Wn.call(arguments, 2),
                    r = -1,
                    i = "function" == typeof e,
                    a = t ? t.length : 0,
                    s = Array("number" == typeof a ? a : 0);
                return V(t, function(t) {
                    s[++r] = (i ? e : t[e]).apply(t, n)
                }), s
            }

            function Q(t, e, n) {
                var r = -1,
                    i = t ? t.length : 0;
                if (e = Ne(e, n, 3), "number" == typeof i)
                    for (var a = Array(i); ++r < i;) a[r] = e(t[r], r, t);
                else a = [], er(t, function(t, n, i) {
                    a[++r] = e(t, n, i)
                });
                return a
            }

            function Z(t, e, n) {
                var r = -1 / 0,
                    i = r,
                    a = -1,
                    s = t ? t.length : 0;
                if (e || "number" != typeof s) e = Ne(e, n, 3), V(t, function(t, n, a) {
                    var s = e(t, n, a);
                    s > r && (r = s, i = t)
                });
                else
                    for (; ++a < s;) {
                        var o = t[a];
                        o > i && (i = o)
                    }
                return i
            }

            function H(t, e, n) {
                var r = 1 / 0,
                    i = r,
                    a = -1,
                    s = t ? t.length : 0;
                if (e || "number" != typeof s) e = Ne(e, n, 3), V(t, function(t, n, a) {
                    var s = e(t, n, a);
                    r > s && (r = s, i = t)
                });
                else
                    for (; ++a < s;) {
                        var o = t[a];
                        i > o && (i = o)
                    }
                return i
            }

            function K(t, e) {
                var n = -1,
                    r = t ? t.length : 0;
                if ("number" == typeof r)
                    for (var i = Array(r); ++n < r;) i[n] = t[n][e];
                return i || Q(t, e)
            }

            function te(t, e, n, r) {
                if (!t) return n;
                var i = arguments.length < 3;
                e = o(e, r, 4);
                var a = -1,
                    s = t.length;
                if ("number" == typeof s)
                    for (i && (n = t[++a]); ++a < s;) n = e(n, t[a], a, t);
                else er(t, function(t, r, a) {
                    n = i ? (i = !1, t) : e(n, t, r, a)
                });
                return n
            }

            function ee(t, e, n, r) {
                var i = arguments.length < 3;
                return e = o(e, r, 4), U(t, function(t, r, a) {
                    n = i ? (i = !1, t) : e(n, t, r, a)
                }), n
            }

            function ne(t, e, n) {
                return e = Ne(e, n, 3), q(t, function(t, n, r) {
                    return !e(t, n, r)
                })
            }

            function re(t, e, n) {
                var r = t ? t.length : 0;
                if ("number" != typeof r && (t = P(t)), null == e || n) return t ? t[qe(r - 1)] : tn;
                var i = ie(t);
                return i.length = Pn($n(0, e), i.length), i
            }

            function ie(t) {
                var e = -1,
                    n = t ? t.length : 0,
                    r = Array("number" == typeof n ? n : 0);
                return V(t, function(t) {
                    var n = qe(++e);
                    r[e] = r[n], r[n] = t
                }), r
            }

            function ae(t) {
                var e = t ? t.length : 0;
                return "number" == typeof e ? e : Gn(t).length
            }

            function se(t, e, n) {
                var r;
                e = Ne(e, n, 3);
                var i = -1,
                    a = t ? t.length : 0;
                if ("number" == typeof a)
                    for (; ++i < a && !(r = e(t[i], i, t)););
                else er(t, function(t, n, i) {
                    return (r = e(t, n, i)) && nn
                });
                return !!r
            }

            function oe(t, e, r) {
                var i = -1,
                    a = t ? t.length : 0,
                    s = Array("number" == typeof a ? a : 0);
                for (e = Ne(e, r, 3), V(t, function(t, n, r) {
                        s[++i] = {
                            criteria: e(t, n, r),
                            index: i,
                            value: t
                        }
                    }), a = s.length, s.sort(n); a--;) s[a] = s[a].value;
                return s
            }

            function ue(t) {
                return Vn(t) ? Wn.call(t) : t && "number" == typeof t.length ? Q(t) : P(t)
            }

            function le(t, e, n) {
                return n && O(e) ? tn : (n ? X : q)(t, e)
            }

            function ce(t) {
                for (var e = -1, n = t ? t.length : 0, r = []; ++e < n;) {
                    var i = t[e];
                    i && r.push(i)
                }
                return r
            }

            function fe(t) {
                for (var e = -1, n = d(), r = t.length, i = u(arguments, !0, !0, 1), a = []; ++e < r;) {
                    var s = t[e];
                    n(i, s) < 0 && a.push(s)
                }
                return a
            }

            function pe(t, e, n) {
                var r = 0,
                    i = t ? t.length : 0;
                if ("number" != typeof e && null != e) {
                    var a = -1;
                    for (e = Ne(e, n, 3); ++a < i && e(t[a], a, t);) r++
                } else if (r = e, null == r || n) return t ? t[0] : tn;
                return Wn.call(t, 0, Pn($n(0, r), i))
            }

            function he(t, e) {
                return u(t, e)
            }

            function me(t, n, r) {
                if ("number" == typeof r) {
                    var i = t ? t.length : 0;
                    r = 0 > r ? $n(0, i + r) : r || 0
                } else if (r) {
                    var a = xe(t, n);
                    return t[a] === n ? a : -1
                }
                return e(t, n, r)
            }

            function de(t, e, n) {
                var r = 0,
                    i = t ? t.length : 0;
                if ("number" != typeof e && null != e) {
                    var a = i;
                    for (e = Ne(e, n, 3); a-- && e(t[a], a, t);) r++
                } else r = null == e || n ? 1 : e || r;
                return Wn.call(t, 0, Pn($n(0, i - r), i))
            }

            function ge(t) {
                var e = arguments,
                    n = e.length,
                    r = -1,
                    i = d(),
                    a = t ? t.length : 0,
                    s = [];
                t: for (; ++r < a;) {
                    var o = t[r];
                    if (i(s, o) < 0) {
                        for (var u = n; --u;)
                            if (i(e[u], o) < 0) continue t;
                        s.push(o)
                    }
                }
                return s
            }

            function ve(t, e, n) {
                var r = 0,
                    i = t ? t.length : 0;
                if ("number" != typeof e && null != e) {
                    var a = i;
                    for (e = Ne(e, n, 3); a-- && e(t[a], a, t);) r++
                } else if (r = e, null == r || n) return t ? t[i - 1] : tn;
                return Wn.call(t, $n(0, i - r))
            }

            function ye(t, e, n) {
                var r = t ? t.length : 0;
                for ("number" == typeof n && (r = (0 > n ? $n(0, r + n) : Pn(n, r - 1)) + 1); r--;)
                    if (t[r] === e) return r;
                return -1
            }

            function _e(t, e, n) {
                t = +t || 0, n = +n || 1, null == e && (e = t, t = 0);
                for (var r = -1, i = $n(0, On((e - t) / n)), a = Array(i); ++r < i;) a[r] = t, t += n;
                return a
            }

            function be(t, e, n) {
                if ("number" != typeof e && null != e) {
                    var r = 0,
                        i = -1,
                        a = t ? t.length : 0;
                    for (e = Ne(e, n, 3); ++i < a && e(t[i], i, t);) r++
                } else r = null == e || n ? 1 : $n(0, e);
                return Wn.call(t, r)
            }

            function xe(t, e, n, r) {
                var i = 0,
                    a = t ? t.length : i;
                for (n = n ? Ne(n, r, 1) : Pe, e = n(e); a > i;) {
                    var s = i + a >>> 1;
                    n(t[s]) < e ? i = s + 1 : a = s
                }
                return i
            }

            function we() {
                return c(u(arguments, !0, !0))
            }

            function Te(t, e, n, r) {
                return "boolean" != typeof e && null != e && (r = n, n = r && r[e] === t ? null : e, e = !1), null != n && (n = Ne(n, r, 3)), c(t, e, n)
            }

            function Ae(t) {
                return fe(t, Wn.call(arguments, 1))
            }

            function Ee() {
                for (var t = -1, e = Z(K(arguments, "length")), n = Array(0 > e ? 0 : e); ++t < e;) n[t] = K(arguments, t);
                return n
            }

            function je(t, e) {
                for (var n = -1, r = t ? t.length : 0, i = {}; ++n < r;) {
                    var a = t[n];
                    e ? i[a] = e[n] : a && (i[a[0]] = a[1])
                }
                return i
            }

            function Oe(t, e) {
                if (!M(e)) throw new TypeError;
                return function() {
                    return --t < 1 ? e.apply(this, arguments) : void 0
                }
            }

            function Se(t, e) {
                return arguments.length > 2 ? p(t, 17, Wn.call(arguments, 2), null, e) : p(t, 1, null, null, e)
            }

            function ke(t) {
                for (var e = arguments.length > 1 ? u(arguments, !0, !1, 1) : x(t), n = -1, r = e.length; ++n < r;) {
                    var i = e[n];
                    t[i] = p(t[i], 1, null, null, t)
                }
                return t
            }

            function Me() {
                for (var t = arguments, e = t.length; e--;)
                    if (!M(t[e])) throw new TypeError;
                return function() {
                    for (var e = arguments, n = t.length; n--;) e = [t[n].apply(this, e)];
                    return e[0]
                }
            }

            function Ne(t, e, n) {
                var r = typeof t;
                if (null == t || "function" == r) return o(t, e, n);
                if ("object" != r) return function(e) {
                    return e[t]
                };
                var i = Gn(t);
                return function(e) {
                    for (var n = i.length, r = !1; n-- && (r = e[i[n]] === t[i[n]]););
                    return r
                }
            }

            function Re(t, e, n) {
                var r, i, a, s, o, u, l, c = 0,
                    f = !1,
                    p = !0;
                if (!M(t)) throw new TypeError;
                if (e = $n(0, e) || 0, n === !0) {
                    var h = !0;
                    p = !1
                } else N(n) && (h = n.leading, f = "maxWait" in n && ($n(e, n.maxWait) || 0), p = "trailing" in n ? n.trailing : p);
                var m = function() {
                        var n = e - (Mn() - s);
                        if (0 >= n) {
                            i && clearTimeout(i);
                            var f = l;
                            i = u = l = tn, f && (c = Mn(), a = t.apply(o, r))
                        } else u = setTimeout(m, n)
                    },
                    d = function() {
                        u && clearTimeout(u), i = u = l = tn, (p || f !== e) && (c = Mn(), a = t.apply(o, r))
                    };
                return function() {
                    if (r = arguments, s = Mn(), o = this, l = p && (u || !h), f === !1) var n = h && !u;
                    else {
                        i || h || (c = s);
                        var g = f - (s - c);
                        0 >= g ? (i && (i = clearTimeout(i)), c = s, a = t.apply(o, r)) : i || (i = setTimeout(d, g))
                    }
                    return u || e === f || (u = setTimeout(m, e)), n && (a = t.apply(o, r)), a
                }
            }

            function Ie(t) {
                if (!M(t)) throw new TypeError;
                var e = Wn.call(arguments, 1);
                return setTimeout(function() {
                    t.apply(tn, e)
                }, 1)
            }

            function Be(t, e) {
                if (!M(t)) throw new TypeError;
                var n = Wn.call(arguments, 2);
                return setTimeout(function() {
                    t.apply(tn, n)
                }, e)
            }

            function ze(t, e) {
                var n = {};
                return function() {
                    var r = e ? e.apply(this, arguments) : rn + arguments[0];
                    return kn.call(n, r) ? n[r] : n[r] = t.apply(this, arguments)
                }
            }

            function Ce(t) {
                var e, n;
                if (!M(t)) throw new TypeError;
                return function() {
                    return e ? n : (e = !0, n = t.apply(this, arguments), t = null, n)
                }
            }

            function De(t) {
                return p(t, 16, Wn.call(arguments, 1))
            }

            function Fe(t, e, n) {
                var r = !0,
                    i = !0;
                if (!M(t)) throw new TypeError;
                return n === !1 ? r = !1 : N(n) && (r = "leading" in n ? n.leading : r, i = "trailing" in n ? n.trailing : i), n = {}, n.leading = r, n.maxWait = e, n.trailing = i, Re(t, e, n)
            }

            function Le(t, e) {
                if (!M(e)) throw new TypeError;
                return function() {
                    var n = [t];
                    return Nn.apply(n, arguments), e.apply(this, n)
                }
            }

            function $e(t) {
                return null == t ? "" : String(t).replace(Kn, m)
            }

            function Pe(t) {
                return t
            }

            function Je(t) {
                V(x(t), function(e) {
                    var n = a[e] = t[e];
                    a.prototype[e] = function() {
                        var t = [this.__wrapped__];
                        Nn.apply(t, arguments);
                        var e = n.apply(a, t);
                        return this.__chain__ ? new s(e, !0) : e
                    }
                })
            }

            function We() {
                return _n._ = En, this
            }

            function qe(t, e) {
                return null == t && null == e && (e = 1), t = +t || 0, null == e ? (e = t, t = 0) : e = +e || 0, t + Sn(Jn() * (e - t + 1))
            }

            function Xe(t, e) {
                if (t) {
                    var n = t[e];
                    return M(n) ? t[e]() : n
                }
            }

            function Ye(t, e, n) {
                var i = a,
                    s = i.templateSettings;
                t || (t = ""), n = b({}, n, s);
                var o = 0,
                    u = "__p += '",
                    l = n.variable,
                    c = RegExp((n.escape || sn).source + "|" + (n.interpolate || sn).source + "|" + (n.evaluate || sn).source + "|$", "g");
                t.replace(c, function(e, n, i, a, s) {
                    return u += t.slice(o, s).replace(on, r), n && (u += "' +\n_.escape(" + n + ") +\n'"), a && (u += "';\n" + a + ";\n__p += '"), i && (u += "' +\n((__t = (" + i + ")) == null ? '' : __t) +\n'"), o = s + e.length, e
                }), u += "';\n", l || (l = "obj", u = "with (" + l + " || {}) {\n" + u + "\n}\n"), u = "function(" + l + ") {\nvar __t, __p = '', __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n" + u + "return __p\n}";
                try {
                    var f = Function("_", "return " + u)(i)
                } catch (p) {
                    throw p.source = u, p
                }
                return e ? f(e) : (f.source = u, f)
            }

            function Ve(t, e, n) {
                t = (t = +t) > -1 ? t : 0;
                var r = -1,
                    i = Array(t);
                for (e = o(e, n, 1); ++r < t;) i[r] = e(r);
                return i
            }

            function Ue(t) {
                return null == t ? "" : String(t).replace(Hn, g)
            }

            function Ge(t) {
                var e = ++en + "";
                return t ? t + e : e
            }

            function Qe(t) {
                return t = new s(t), t.__chain__ = !0, t
            }

            function Ze(t, e) {
                return e(t), t
            }

            function He() {
                return this.__chain__ = !0, this
            }

            function Ke() {
                return this.__wrapped__
            }
            var tn, en = 0,
                nn = {},
                rn = +new Date + "",
                an = /<%=([\s\S]+?)%>/g,
                sn = /($^)/,
                on = /['\n\r\t\u2028\u2029\\]/g,
                un = "[object Arguments]",
                ln = "[object Array]",
                cn = "[object Boolean]",
                fn = "[object Date]",
                pn = "[object Function]",
                hn = "[object Number]",
                mn = "[object Object]",
                dn = "[object RegExp]",
                gn = "[object String]",
                vn = {
                    "boolean": !1,
                    "function": !0,
                    object: !0,
                    number: !1,
                    string: !1,
                    undefined: !1
                },
                yn = {
                    "\\": "\\",
                    "'": "'",
                    "\n": "n",
                    "\r": "r",
                    "	": "t",
                    "\u2028": "u2028",
                    "\u2029": "u2029"
                },
                _n = vn[typeof window] && window || this,
                bn = vn[typeof exports] && exports && !exports.nodeType && exports,
                xn = vn[typeof module] && module && !module.nodeType && module,
                wn = (xn && xn.exports === bn && bn, vn[typeof global] && global);
            !wn || wn.global !== wn && wn.window !== wn || (_n = wn);
            var Tn = [],
                An = Object.prototype,
                En = _n._,
                jn = RegExp("^" + String(An.valueOf).replace(/[.*+?^${}()|[\]\\]/g, "\\$&").replace(/valueOf|for [^\]]+/g, ".+?") + "$"),
                On = Math.ceil,
                Sn = Math.floor,
                kn = An.hasOwnProperty,
                Mn = jn.test(Mn = Date.now) && Mn || function() {
                    return +new Date
                },
                Nn = Tn.push,
                Rn = An.toString,
                In = Tn.unshift,
                Bn = jn.test(Bn = Rn.bind) && Bn,
                zn = jn.test(zn = Object.create) && zn,
                Cn = jn.test(Cn = Array.isArray) && Cn,
                Dn = _n.isFinite,
                Fn = _n.isNaN,
                Ln = jn.test(Ln = Object.keys) && Ln,
                $n = Math.max,
                Pn = Math.min,
                Jn = Math.random,
                Wn = Tn.slice,
                qn = jn.test(_n.attachEvent),
                Xn = Bn && !/\n|true/.test(Bn + qn);
            s.prototype = a.prototype;
            var Yn = {};
            ! function() {
                var t = {
                    0: 1,
                    length: 1
                };
                Yn.fastBind = Bn && !Xn, Yn.spliceObjects = (Tn.splice.call(t, 0, 1), !t[0])
            }(1), a.templateSettings = {
                escape: /<%-([\s\S]+?)%>/g,
                evaluate: /<%([\s\S]+?)%>/g,
                interpolate: an,
                variable: ""
            }, zn || (h = function(t) {
                if (N(t)) {
                    i.prototype = t;
                    var e = new i;
                    i.prototype = null
                }
                return e || {}
            }), v(arguments) || (v = function(t) {
                return t && "object" == typeof t && "number" == typeof t.length && kn.call(t, "callee") || !1
            });
            var Vn = Cn || function(t) {
                    return t && "object" == typeof t && "number" == typeof t.length && Rn.call(t) == ln || !1
                },
                Un = function(t) {
                    var e, n = t,
                        r = [];
                    if (!n) return r;
                    if (!vn[typeof t]) return r;
                    for (e in n) kn.call(n, e) && r.push(e);
                    return r
                },
                Gn = Ln ? function(t) {
                    return N(t) ? Ln(t) : []
                } : Un,
                Qn = {
                    "&": "&amp;",
                    "<": "&lt;",
                    ">": "&gt;",
                    '"': "&quot;",
                    "'": "&#x27;"
                },
                Zn = T(Qn),
                Hn = RegExp("(" + Gn(Zn).join("|") + ")", "g"),
                Kn = RegExp("[" + Gn(Qn).join("") + "]", "g"),
                tr = function(t, e) {
                    var n, r = t,
                        i = r;
                    if (!r) return i;
                    if (!vn[typeof r]) return i;
                    for (n in r)
                        if (e(r[n], n, t) === nn) return i;
                    return i
                },
                er = function(t, e) {
                    var n, r = t,
                        i = r;
                    if (!r) return i;
                    if (!vn[typeof r]) return i;
                    for (n in r)
                        if (kn.call(r, n) && e(r[n], n, t) === nn) return i;
                    return i
                };
            M(/x/) && (M = function(t) {
                return "function" == typeof t && Rn.call(t) == pn
            });
            var nr = f(function(t, e, n) {
                    kn.call(t, n) ? t[n]++ : t[n] = 1
                }),
                rr = f(function(t, e, n) {
                    (kn.call(t, n) ? t[n] : t[n] = []).push(e)
                }),
                ir = f(function(t, e, n) {
                    t[n] = e
                });
            a.after = Oe, a.bind = Se, a.bindAll = ke, a.chain = Qe, a.compact = ce, a.compose = Me, a.countBy = nr, a.debounce = Re, a.defaults = b, a.defer = Ie, a.delay = Be, a.difference = fe, a.filter = q, a.flatten = he, a.forEach = V, a.functions = x, a.groupBy = rr, a.indexBy = ir, a.initial = de, a.intersection = ge, a.invert = T, a.invoke = G, a.keys = Gn, a.map = Q, a.max = Z, a.memoize = ze, a.min = H, a.omit = F, a.once = Ce, a.pairs = L, a.partial = De, a.pick = $, a.pluck = K, a.range = _e, a.reject = ne, a.rest = be, a.shuffle = ie, a.sortBy = oe, a.tap = Ze, a.throttle = Fe, a.times = Ve, a.toArray = ue, a.union = we, a.uniq = Te, a.values = P, a.where = le, a.without = Ae, a.wrap = Le, a.zip = Ee, a.collect = Q, a.drop = be, a.each = V, a.extend = y, a.methods = x, a.object = je, a.select = q, a.tail = be, a.unique = Te, a.clone = _, a.contains = J, a.escape = $e, a.every = W, a.find = X, a.has = w, a.identity = Pe, a.indexOf = me, a.isArguments = v, a.isArray = Vn, a.isBoolean = A, a.isDate = E, a.isElement = j, a.isEmpty = O, a.isEqual = S, a.isFinite = k, a.isFunction = M, a.isNaN = R, a.isNull = I, a.isNumber = B, a.isObject = N, a.isRegExp = z, a.isString = C, a.isUndefined = D, a.lastIndexOf = ye, a.mixin = Je, a.noConflict = We, a.random = qe, a.reduce = te, a.reduceRight = ee, a.result = Xe, a.size = ae, a.some = se, a.sortedIndex = xe, a.template = Ye, a.unescape = Ue, a.uniqueId = Ge, a.all = W, a.any = se, a.detect = X, a.findWhere = Y, a.foldl = te, a.foldr = ee, a.include = J, a.inject = te, a.first = pe, a.last = ve, a.sample = re, a.take = pe, a.head = pe, Je(a), a.VERSION = "2.2.1", a.prototype.chain = He, a.prototype.value = Ke, V(["pop", "push", "reverse", "shift", "sort", "splice", "unshift"], function(t) {
                var e = Tn[t];
                a.prototype[t] = function() {
                    var t = this.__wrapped__;
                    return e.apply(t, arguments), Yn.spliceObjects || 0 !== t.length || delete t[0], this
                }
            }), V(["concat", "join", "slice"], function(t) {
                var e = Tn[t];
                a.prototype[t] = function() {
                    var t = this.__wrapped__,
                        n = e.apply(t, arguments);
                    return this.__chain__ && (n = new s(n), n.__chain__ = !0), n
                }
            }), a.extend(t, a)
        }).call(t)
    }(use("spirit._helpers")),
    function(t) {
        "use strict";
        var e = function() {};
        t.extendObject = function(e, n) {
            var r, i = this;
            r = e && t.has(e, "constructor") ? e.constructor : function() {
                return i.apply(this, arguments)
            }, t.extend(r, i, n);
            var a = function() {
                this.constructor = r
            };
            return a.prototype = i.prototype, r.prototype = new a, e && t.extend(r.prototype, e), r.__super__ = i.prototype, r
        };
        var n = function(n, r, i) {
            var a, s = n.prototype,
                o = /xyz/.test(function(t) {}) ? /\b_super\b/ : /.*/;
            if (a = r && r.hasOwnProperty("constructor") ? r.constructor : function() {
                    n.apply(this, arguments)
                }, t.extend(a, n), e.prototype = n.prototype, a.prototype = new e, r) {
                t.extend(a.prototype, r);
                for (var u in r) "function" == typeof r[u] && "function" == typeof s[u] && o.test(r[u]) && (a.prototype[u] = function(t, e) {
                    return function() {
                        var n = this._super;
                        this._super = s[t];
                        var r = e.apply(this, arguments);
                        return this._super = n, r
                    }
                }(u, r[u]))
            }
            return i && t.extend(a, i), a.prototype.constructor = a, a.__super__ = n.prototype, a
        };
        t.extendObjectWithSuper = function(e, r) {
            var i = n(this, e, r);
            return i.extend = t.extendObject, i
        }, t.autoBind = function(e) {
            var n = t.functions(e.constructor.prototype);
            t.each(n, function(n) {
                "_" !== n.charAt(0) && -1 === t.indexOf(["autoBind", "constructor"], n) && (e[n] = t.bind(e[n], e))
            })
        }, t.testMode = function() {
            return !!window.__karma__
        }, t.raf = function() {
            for (var t = 0, e = ["webkit", "moz"], n = window.requestAnimationFrame, r = 0; r < e.length && !n; ++r) n = window[e[r] + "RequestAnimationFrame"];
            return n ? n : function(e) {
                var n = (new Date).getTime(),
                    r = Math.max(0, 16 - (n - t)),
                    i = window.setTimeout(function() {
                        e(n + r)
                    }, r);
                return t = n + r, i
            }
        }
    }(use("spirit._helpers"));
    var debug = !0,
        _ = use("spirit._helpers"),
        log = function() {
            if (window.__karma__) return !1;
            if (window.console && _.isFunction(window.console.log)) {
                var t = [].slice.call(arguments);
                t.unshift("Spirit: ->"), console.log.apply(console, t)
            }
            return !0
        },
        globalDefaults = {
            tween: _.isFunction(window.TweenMax) ? window.TweenMax : window.TweenLite,
            timeline: _.isFunction(window.TimelineMax) ? window.TimelineMax : window.TimelineLite
        };
    ! function(t) {
        "use strict";
        ! function() {
            var t = document.createElement("div");
            return new globalDefaults.tween(t, 0, {
                x: 0
            }).play(), t._gsTransform
        }();
        t.Timeline = function(t, e) {
            var n = new globalDefaults.timeline({
                    useFrames: !0,
                    paused: !0
                }),
                r = e.mappings;
            return e.each(function(e) {
                var i = e.get("frame"),
                    a = e.get("previousModel"),
                    s = a ? a.get("frame") : 0,
                    o = e.get("params").constructTweenObject(r);
                o.ease = e.get("ease"), a && (i -= a.get("frame")), _.isEmpty(o) || n.add(globalDefaults.tween.to(t.get(0), i, o).play(), s)
            }, this), n
        }
    }(use("spirit.factory")),
    function(t) {
        "use strict";
        var e = /\s+/,
            n = function(t, n, r, i) {
                if (!r) return !0;
                if ("object" == typeof r) {
                    for (var a in r) t[n].apply(t, [a, r[a]].concat(i));
                    return !1
                }
                if (e.test(r)) {
                    for (var s = r.split(e), o = 0, u = s.length; u > o; o++) t[n].apply(t, [s[o]].concat(i));
                    return !1
                }
                return !0
            },
            r = function(t, e) {
                var n, r = -1,
                    i = t.length,
                    a = e[0],
                    s = e[1],
                    o = e[2];
                switch (e.length) {
                    case 0:
                        for (; ++r < i;)(n = t[r]).callback.call(n.ctx);
                        return;
                    case 1:
                        for (; ++r < i;)(n = t[r]).callback.call(n.ctx, a);
                        return;
                    case 2:
                        for (; ++r < i;)(n = t[r]).callback.call(n.ctx, a, s);
                        return;
                    case 3:
                        for (; ++r < i;)(n = t[r]).callback.call(n.ctx, a, s, o);
                        return;
                    default:
                        for (; ++r < i;)(n = t[r]).callback.apply(n.ctx, e)
                }
            };
        t.Events = {
            on: function(t, e, r) {
                if (!n(this, "on", t, [e, r]) || !e) return this;
                this._events || (this._events = {});
                var i = this._events[t] || (this._events[t] = []);
                return i.push({
                    callback: e,
                    context: r,
                    ctx: r || this
                }), this
            },
            once: function(t, e, r) {
                if (!n(this, "once", t, [e, r]) || !e) return this;
                var i = this,
                    a = _.once(function() {
                        i.off(t, a), e.apply(this, arguments)
                    });
                return a._callback = e, this.on(t, a, r)
            },
            off: function(t, e, r) {
                var i, a, s, o, u, l, c, f;
                if (!this._events || !n(this, "off", t, [e, r])) return this;
                if (!t && !e && !r) return this._events = {}, this;
                for (o = t ? [t] : _.keys(this._events), u = 0, l = o.length; l > u; u++)
                    if (t = o[u], s = this._events[t]) {
                        if (this._events[t] = i = [], e || r)
                            for (c = 0, f = s.length; f > c; c++) a = s[c], (e && e !== a.callback && e !== a.callback._callback || r && r !== a.context) && i.push(a);
                        i.length || delete this._events[t]
                    }
                return this
            },
            trigger: function(t) {
                if (!this._events) return this;
                var e = [].slice.call(arguments, 1);
                if (!n(this, "trigger", t, e)) return this;
                var i = this._events[t],
                    a = this._events.all;
                return i && r(i, e), a && r(a, arguments), this
            },
            stopListening: function(t, e, n) {
                var r = this._listeningTo;
                if (!r) return this;
                var i = !e && !n;
                n || "object" != typeof e || (n = this), t && ((r = {})[t._listenId] = t);
                for (var a in r) t = r[a], t.off(e, n, this), (i || _.isEmpty(t._events)) && delete this._listeningTo[a];
                return this
            }
        }
    }(use("spirit.event")),
    function(t) {
        "use strict";
        var e = function(t, e) {
                var n = e.error;
                e.error = function(r) {
                    n && n(t, r, e), t.trigger("error", t, r, e)
                }
            },
            n = function(t) {
                var e = t;
                try {
                    if (_.isString(e) && exist(e) && (e = use(e)), e.parseable === !0) return e;
                    if (e.constructor.parseable === !0) return e.constructor
                } catch (n) {}
                return !1
            };
        t.Abstract = function(t, e) {
            this._parseables = {}, _.each(this.defaults, function(t, e) {
                var r = n(t);
                r && (this._parseables[e] = r)
            }, this);
            var r = t || {};
            e || (e = {}), this.cid = _.uniqueId("c"), this.attributes = {}, e.collection && (this.collection = e.collection), e.parse && (r = this.parse(r, e) || {}), r = _.defaults({}, r, _.result(this, "defaults")), this.set(r, e), this.changed = {}, this.initialize.apply(this, arguments)
        }, t.Abstract.extend = _.extendObjectWithSuper, _.extend(t.Abstract.prototype, use("spirit.event").Events, {
            changed: null,
            validationError: null,
            idAttribute: "id",
            initialize: function() {},
            toJSON: function() {
                return _.clone(this.attributes)
            },
            get: function(t) {
                return this.attributes[t]
            },
            escape: function(t) {
                return _.escape(this.get(t))
            },
            has: function(t) {
                return null != this.get(t)
            },
            set: function(e, n, r) {
                var i, a, s, o, u, l, c, f;
                if (null == e) return this;
                if ("object" == typeof e ? (a = e, r = n) : (a = {})[e] = n, r || (r = {}), !this._validate(a, r)) return !1;
                s = r.unset, u = r.silent, o = [], l = this._changing, this._changing = !0, l || (this._previousAttributes = _.clone(this.attributes), this.changed = {}), f = this.attributes, c = this._previousAttributes, this.idAttribute in a && (this.id = a[this.idAttribute]);
                for (i in a)
                    if (n = a[i], _.isEqual(f[i], n) || o.push(i), _.isEqual(c[i], n) ? delete this.changed[i] : this.changed[i] = n, s) delete f[i];
                    else {
                        var p = this._parseables[i];
                        f[i] = p ? _.isArray(n) || _.isObject(n) && n instanceof t.Abstract ? new p(n) : new p : n
                    }
                if (!u) {
                    o.length && (this._pending = !0);
                    for (var h = 0, m = o.length; m > h; h++) this.trigger("change:" + o[h], this, f[o[h]], r)
                }
                if (l) return this;
                if (!u)
                    for (; this._pending;) this._pending = !1, this.trigger("change", this, r);
                return this._pending = !1, this._changing = !1, this
            },
            unset: function(t, e) {
                return this.set(t, void 0, _.extend({}, e, {
                    unset: !0
                }))
            },
            clear: function(t) {
                var e = {};
                for (var n in this.attributes) e[n] = void 0;
                return this.set(e, _.extend({}, t, {
                    unset: !0
                }))
            },
            hasChanged: function(t) {
                return null == t ? !_.isEmpty(this.changed) : _.has(this.changed, t)
            },
            changedAttributes: function(t) {
                if (!t) return this.hasChanged() ? _.clone(this.changed) : !1;
                var e, n = !1,
                    r = this._changing ? this._previousAttributes : this.attributes;
                for (var i in t) _.isEqual(r[i], e = t[i]) || ((n || (n = {}))[i] = e);
                return n
            },
            previous: function(t) {
                return null != t && this._previousAttributes ? this._previousAttributes[t] : null
            },
            previousAttributes: function() {
                return _.clone(this._previousAttributes)
            },
            fetch: function(t) {
                t = t ? _.clone(t) : {}, void 0 === t.parse && (t.parse = !0);
                var n = this,
                    r = t.success;
                return t.success = function(e) {
                    return n.set(n.parse(e, t), t) ? (r && r(n, e, t), void n.trigger("sync", n, e, t)) : !1
                }, e(this, t), this.sync("read", this, t)
            },
            destroy: function(t) {
                t = t ? _.clone(t) : {};
                var n = this,
                    r = t.success,
                    i = function() {
                        n.trigger("destroy", n, n.collection, t)
                    };
                return t.success = function(e) {
                    (t.wait || n.isNew()) && i(), r && r(n, e, t), n.isNew() || n.trigger("sync", n, e, t)
                }, this.isNew() ? (t.success(), !1) : (e(this, t), t.wait || i(), !0)
            },
            url: function() {
                var t = _.result(this, "urlRoot") || _.result(this.collection, "url") || urlError();
                return this.isNew() ? t : t + ("/" === t.charAt(t.length - 1) ? "" : "/") + encodeURIComponent(this.id)
            },
            parse: function(t) {
                return t
            },
            clone: function() {
                return new this.constructor(this.attributes)
            },
            isNew: function() {
                return null == this.id
            },
            isValid: function(t) {
                return this._validate({}, _.extend(t || {}, {
                    validate: !0
                }))
            },
            _validate: function(t, e) {
                if (!e.validate || !this.validate) return !0;
                t = _.extend({}, this.attributes, t);
                var n = this.validationError = this.validate(t, e) || null;
                return n ? (this.trigger("invalid", this, n, _.extend(e, {
                    validationError: n
                })), !1) : !0
            }
        });
        var r = ["keys", "values", "pairs", "invert", "pick", "omit"];
        _.each(r, function(e) {
            t.Abstract.prototype[e] = function() {
                var t = slice.call(arguments);
                return t.unshift(this.attributes), _[e].apply(_, t)
            }
        })
    }(use("spirit.model")),
    function(t) {
        "use strict";
        var e = _.raf();
        t.Group = t.Abstract.extend({
            defaults: {
                name: "no title",
                fps: 30,
                timelines: "spirit.collection.Timelines"
            },
            initialize: function() {
                _.autoBind(this), this.timeline = new globalDefaults.timeline({
                    useFrames: !0,
                    paused: !0
                }), this.timeline.autoRemoveChildren = !1, this._animateProps = {
                    frame: 0
                }, this._tween = null, this.get("timelines").on("add reset remove change change:transitions", this.constructTimeline), this.constructTimeline()
            },
            constructTimeline: function() {
                return this.timeline.kill(), this.timeline.clear(), this.get("timelines").each(function(t) {
                    var e = t.get("el").get(0);
                    globalDefaults.tween.killTweensOf(e), delete e._gsTransform, delete e._gsTweenID, t.get("el").attr("style", ""), this.timeline.add(new(use("spirit.factory").Timeline)(t.get("el"), t.get("transitions")).play(), 0)
                }, this), this.trigger("construct:timeline", this.timeline), this
            },
            play: function(t, e, n) {
                this.stop(), t = t || 0, void 0 === e && (e = this.timeline.duration()), void 0 === n && (n = this.get("fps"));
                var r = Math.abs(e - t) / n;
                globalDefaults.tween.fromTo(this._animateProps, r, {
                    frame: t
                }, {
                    frame: e,
                    ease: "linear",
                    onUpdate: this.onUpdate
                })
            },
            onUpdate: function() {
                e(_.bind(function() {
                    this.timeline.seek(this._animateProps.frame)
                }, this))
            },
            stop: function() {
                globalDefaults.tween.killTweensOf(this._animateProps), this.timeline.paused() || this.timeline.pause()
            },
            toJSON: function() {
                var t = this._super();
                return t.timelines = this.get("timelines").toJSON(), t
            }
        })
    }(use("spirit.model")),
    function(t) {
        "use strict";
        t.State = t.Abstract.extend({
            defaults: {
                name: "undefined",
                tweenObj: {}
            }
        })
    }(use("spirit.model")),
    function(t) {
        "use strict";
        t.Timeline = t.Abstract.extend({
            defaults: {
                el: null,
                id: null,
                transitions: "spirit.collection.Transitions"
            },
            initialize: function() {
                if (_.autoBind(this), this.get("el") instanceof $) this.bindModelToElement(), this.applyMappings();
                else {
                    var t = "[data-spirit-id=" + this.get("id") + "]",
                        e = $(t);
                    if (!(e.length > 0)) throw new Error("[spirit.model.Timeline] Can't apply timeline on element. Element: " + t + " can't be found");
                    this.set({
                        el: $(e.get(0))
                    }, {
                        silent: !0
                    }), this.bindModelToElement(), this.applyMappings()
                }
                return this.get("transitions").updateAll(), this.get("transitions").on("add remove change change:params add:params remove:params", _.bind(function(t) {
                    this.trigger("change:transitions", t)
                }, this)), this
            },
            bindModelToElement: function() {
                return this.get("el").data("spirit-model", this), this
            },
            applyMappings: function() {
                this.get("transitions").mappings.push(new(use("spirit.model.vo").RegExpMapping)(/\$this/g, this.get("el")))
            },
            destroy: function() {
                this.get("transitions").mappings = [], this.get("el") && this.get("el").data("spirit-model", null), this._super()
            }
        })
    }(use("spirit.model")),
    function(t) {
        "use strict";
        t.Transition = t.Abstract.extend({
            defaults: {
                frame: 0,
                params: "spirit.collection.TransitionParams",
                ease: "Linear.easeNone"
            },
            initialize: function() {
                _.autoBind(this), this.get("params").on("change", _.bind(function(t) {
                    this.trigger("change:params", t)
                }, this)), this.get("params").on("add", _.bind(function(t) {
                    this.trigger("add:params", t)
                }, this)), this.get("params").on("remove", _.bind(function(t) {
                    this.trigger("remove:params", t)
                }, this))
            }
        })
    }(use("spirit.model")),
    function(ns) {
        "use strict";
        ns.TransitionParam = ns.Abstract.extend({
            defaults: {
                param: null,
                value: null
            },
            isCSSTransform: function() {
                var t = ["x", "y", "z", "rotateX", "rotateY", "rotateZ", "skewX", "skewY", "scaleX", "scaleY", "scale"];
                return _.contains(t, this.get("param"))
            },
            isEval: function() {
                return /\{(.*?)\}/.test(this.get("value"))
            },
            getValue: function(mappings) {
                var v = this.get("value");
                if (this.isEval()) {
                    if (mappings) {
                        var extractionObject = {};
                        _.each(_.isArray(mappings) ? mappings : [mappings], function(t) {
                            t.expression instanceof RegExp && (t.expression.global && (t.expression.lastIndex = 0), t.expression.test(v) && (extractionObject[t.expression] = t))
                        });
                        for (var i in extractionObject) v = v.replace(extractionObject[i].expression, "extractionObject[" + i + "].map")
                    }
                    try {
                        return eval(v)
                    } catch (e) {}
                }
                return v
            }
        });
        var min = -999999999,
            max = 999999999;
        ns.TransitionParam.params = {
            autoAlpha: {
                type: "number",
                min: 0,
                max: 1,
                step: .005,
                "default": 1
            },
            opacity: {
                type: "number",
                min: 0,
                max: 1,
                step: .005
            },
            x: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            y: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            z: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            width: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            height: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            rotateX: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            rotateY: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            rotateZ: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            skewX: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            skewY: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            scale: {
                type: "number",
                min: min,
                max: max,
                step: .5,
                "default": 1
            },
            scaleX: {
                type: "number",
                min: min,
                max: max,
                step: .5,
                "default": 1
            },
            scaleY: {
                type: "number",
                min: min,
                max: max,
                step: .5,
                "default": 1
            },
            transformOrigin: {
                type: "string",
                "default": "50% 50%"
            },
            perspective: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 400
            },
            perspectiveOrigin: {
                type: "string",
                "default": "50% 50%"
            },
            backgroundPositionX: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            backgroundPositionY: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            color: {
                type: "string"
            },
            backgroundColor: {
                type: "string"
            },
            paddingTop: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            paddingBottom: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            paddingLeft: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            paddingRight: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            marginTop: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            marginBottom: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            marginLeft: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            marginRight: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            fontSize: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            borderWidth: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            borderColor: {
                type: "string"
            },
            borderStyle: {
                type: "string",
                "default": "solid"
            },
            borderTopWidth: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            borderBottomWidth: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            borderLeftWidth: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            borderRightWidth: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            borderTopColor: {
                type: "string"
            },
            borderBottomColor: {
                type: "string"
            },
            borderLeftColor: {
                type: "string"
            },
            borderRightColor: {
                type: "string"
            },
            borderTopLeftRadius: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            borderTopRightRadius: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            borderBottomRightRadius: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            borderBottomLeftRadius: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 0
            },
            zIndex: {
                type: "number",
                min: min,
                max: max,
                step: 1,
                "default": 1
            }
        }
    }(use("spirit.model")),
    function(t) {
        "use strict";
        t.RegExpMapping = function(t, e) {
            this.expression = t, this.map = e
        }
    }(use("spirit.model.vo")),
    function(t) {
        "use strict";
        var e = {
                add: !0,
                remove: !0,
                merge: !0
            },
            n = {
                add: !0,
                remove: !1
            };
        t.Abstract = function(t, e) {
            this.model = exist(this.model) ? use(this.model) : use("spirit.model").Abstract, e || (e = {}), e.model && (this.model = e.model), void 0 !== e.comparator && (this.comparator = e.comparator), this._reset(), this.initialize.apply(this, arguments), t && this.reset(t, _.extend({
                silent: !0
            }, e))
        }, t.Abstract.extend = _.extendObjectWithSuper, _.extend(t.Abstract.prototype, use("spirit.event").Events, {
            model: "spirit.model.Abstract",
            initialize: function() {},
            toJSON: function(t) {
                return this.map(function(e) {
                    return e.toJSON(t)
                })
            },
            add: function(t, e) {
                return this.set(t, _.extend({
                    merge: !1
                }, e, n))
            },
            remove: function(t, e) {
                var n = !_.isArray(t);
                t = n ? [t] : _.clone(t), e || (e = {});
                var r, i, a, s;
                for (r = 0, i = t.length; i > r; r++) s = t[r] = this.get(t[r]), s && (delete this._byId[s.id], delete this._byId[s.cid], a = this.indexOf(s), this.models.splice(a, 1), this.length--, e.silent || (e.index = a, s.trigger("remove", s, this, e)), this._removeReference(s));
                return n ? t[0] : t
            },
            set: function(t, n) {
                n = _.defaults({}, n, e), n.parse && (t = this.parse(t, n));
                var r = !_.isArray(t);
                t = r ? t ? [t] : [] : _.clone(t);
                var i, a, s, o, u, l, c, f = n.at,
                    p = this.model,
                    h = this.comparator && null == f && n.sort !== !1,
                    m = _.isString(this.comparator) ? this.comparator : null,
                    d = [],
                    g = [],
                    v = {},
                    y = n.add,
                    b = n.merge,
                    x = n.remove,
                    w = !h && y && x ? [] : !1;
                for (i = 0, a = t.length; a > i; i++) {
                    if (u = t[i], s = u instanceof use("spirit.model").Abstract ? o = u : u[p.prototype.idAttribute], l = this.get(s)) x && (v[l.cid] = !0), b && (u = u === o ? o.attributes : u, n.parse && (u = l.parse(u, n)), l.set(u, n), h && !c && l.hasChanged(m) && (c = !0)), t[i] = l;
                    else if (y) {
                        if (o = t[i] = this._prepareModel(u, n), !o) continue;
                        d.push(o), o.on("all", this._onModelEvent, this), this._byId[o.cid] = o, null != o.id && (this._byId[o.id] = o)
                    }
                    w && w.push(l || o)
                }
                if (x) {
                    for (i = 0, a = this.length; a > i; ++i) v[(o = this.models[i]).cid] || g.push(o);
                    g.length && this.remove(g, n)
                }
                if (d.length || w && w.length)
                    if (h && (c = !0), this.length += d.length, null != f)
                        for (i = 0, a = d.length; a > i; i++) this.models.splice(f + i, 0, d[i]);
                    else {
                        w && (this.models.length = 0);
                        var T = w || d;
                        for (i = 0, a = T.length; a > i; i++) this.models.push(T[i])
                    }
                if (c && this.sort({
                        silent: !0
                    }), !n.silent) {
                    for (i = 0, a = d.length; a > i; i++)(o = d[i]).trigger("add", o, this, n);
                    (c || w && w.length) && this.trigger("sort", this, n)
                }
                return r ? t[0] : t
            },
            reset: function(t, e) {
                e || (e = {});
                for (var n = 0, r = this.models.length; r > n; n++) this._removeReference(this.models[n]);
                return e.previousModels = this.models, this._reset(), t = this.add(t, _.extend({
                    silent: !0
                }, e)), e.silent || this.trigger("reset", this, e), t
            },
            push: function(t, e) {
                return this.add(t, _.extend({
                    at: this.length
                }, e))
            },
            pop: function(t) {
                var e = this.at(this.length - 1);
                return this.remove(e, t), e
            },
            unshift: function(t, e) {
                return this.add(t, _.extend({
                    at: 0
                }, e))
            },
            shift: function(t) {
                var e = this.at(0);
                return this.remove(e, t), e
            },
            slice: function() {
                return slice.apply(this.models, arguments)
            },
            get: function(t) {
                return null == t ? void 0 : this._byId[t.id] || this._byId[t.cid] || this._byId[t]
            },
            at: function(t) {
                return this.models[t]
            },
            where: function(t, e) {
                return _.isEmpty(t) ? e ? void 0 : [] : this[e ? "find" : "filter"](function(e) {
                    for (var n in t)
                        if (t[n] !== e.get(n)) return !1;
                    return !0
                })
            },
            findWhere: function(t) {
                return this.where(t, !0)
            },
            sort: function(t) {
                if (!this.comparator) throw new Error("Cannot sort a set without a comparator");
                return t || (t = {}), _.isString(this.comparator) || 1 === this.comparator.length ? this.models = this.sortBy(this.comparator, this) : this.models.sort(_.bind(this.comparator, this)), t.silent || this.trigger("sort", this, t), this
            },
            pluck: function(t) {
                return _.invoke(this.models, "get", t)
            },
            create: function(t, e) {
                if (e = e ? _.clone(e) : {}, !(t = this._prepareModel(t, e))) return !1;
                e.wait || this.add(t, e);
                var n = this,
                    r = e.success;
                return e.success = function(t, e, i) {
                    i.wait && n.add(t, i), r && r(t, e, i)
                }, t.save(null, e), t
            },
            parse: function(t) {
                return t
            },
            clone: function() {
                return new this.constructor(this.models)
            },
            _reset: function() {
                this.length = 0, this.models = [], this._byId = {}
            },
            _prepareModel: function(t, e) {
                if (t instanceof use("spirit.model").Abstract) return t.collection || (t.collection = this), t;
                e = e ? _.clone(e) : {}, e.collection = this;
                var n = new this.model(t, e);
                return n.validationError ? (this.trigger("invalid", this, n.validationError, e), !1) : n
            },
            _removeReference: function(t) {
                this === t.collection && delete t.collection, t.off("all", this._onModelEvent, this)
            },
            _onModelEvent: function(t, e, n, r) {
                ("add" !== t && "remove" !== t || n === this) && ("destroy" === t && this.remove(e, r), e && t === "change:" + e.idAttribute && (delete this._byId[e.previous(e.idAttribute)], null != e.id && (this._byId[e.id] = e)), this.trigger.apply(this, arguments))
            }
        }), t.Abstract.parseable = !0;
        var r = ["forEach", "each", "map", "collect", "reduce", "foldl", "inject", "reduceRight", "foldr", "find", "detect", "filter", "select", "reject", "every", "all", "some", "any", "include", "contains", "invoke", "max", "min", "toArray", "size", "first", "head", "take", "initial", "rest", "tail", "drop", "last", "without", "difference", "indexOf", "shuffle", "lastIndexOf", "isEmpty", "chain"];
        _.each(r, function(e) {
            t.Abstract.prototype[e] = function() {
                var t = [].slice.call(arguments);
                return t.unshift(this.models), _[e].apply(_, t)
            }
        });
        var i = ["groupBy", "countBy", "sortBy"];
        _.each(i, function(e) {
            t.Abstract.prototype[e] = function(t, n) {
                var r = _.isFunction(t) ? t : function(e) {
                    return e.get(t)
                };
                return _[e](this.models, r, n)
            }
        })
    }(use("spirit.collection")),
    function(t) {
        "use strict";
        t.Groups = t.Abstract.extend({
            model: "spirit.model.Group"
        })
    }(use("spirit.collection")),
    function(t) {
        "use strict";
        t.States = t.Abstract.extend({
            model: "spirit.model.State"
        })
    }(use("spirit.collection")),
    function(t) {
        "use strict";
        t.Timelines = t.Abstract.extend({
            model: "spirit.model.Timeline",
            toJSON: function() {
                var t = [];
                return this.each(function(e) {
                    t.push({
                        id: e.get("id"),
                        transitions: e.get("transitions").toJSON()
                    })
                }), t
            }
        })
    }(use("spirit.collection")),
    function(t) {
        "use strict";
        t.TransitionParams = t.Abstract.extend({
            model: "spirit.model.TransitionParam",
            constructTweenObject: function(t) {
                var e = {};
                return _.each(this.filter(function(t) {
                    return null !== t.get("param") && null !== t.get("value")
                }), function(n) {
                    switch (n.get("param")) {
                        case "rotateX":
                            e.rotationX = "+=" + n.getValue(t) + "deg";
                            break;
                        case "rotateY":
                            e.rotationY = "+=" + n.getValue(t) + "deg";
                            break;
                        case "rotateZ":
                            e.rotationZ = "+=" + n.getValue(t) + "deg";
                            break;
                        case "skewX":
                            e.skewX = n.getValue(t) + "deg";
                            break;
                        case "skewY":
                            e.skewY = n.getValue(t) + "deg";
                            break;
                        default:
                            e[n.get("param")] = n.getValue(t)
                    }
                }), e
            },
            toJSON: function() {
                var t = [];
                return this.each(function(e) {
                    t.push({
                        param: e.get("param"),
                        value: e.get("value")
                    })
                }), t
            }
        })
    }(use("spirit.collection")),
    function(t) {
        "use strict";
        t.Transitions = t.Abstract.extend({
            model: "spirit.model.Transition",
            mappings: [],
            comparator: "frame",
            initialize: function() {
                return _.autoBind(this), this.mappings = [], this.on("reset add remove", this.updateAll), this
            },
            updateModel: function(t) {
                var e, n = this.indexOf(t);
                return n > 0 && (e = this.at(n - 1)), t.set({
                    previousModel: e
                }), this
            },
            updateAll: function() {
                return this.each(this.updateModel)
            },
            toJSON: function() {
                var t = [];
                return this.each(function(e) {
                    t.push({
                        frame: e.get("frame"),
                        ease: e.get("ease"),
                        params: e.get("params").toJSON()
                    })
                }), t
            }
        })
    }(use("spirit.collection")),
    function() {
        "use strict";
        var t = (use("spirit.model"), use("spirit.collection")),
            e = globalDefaults.tween,
            n = function(t) {
                var e = {};
                try {
                    var n = t.replace(/'|"/g, "").replace(/((?![\d]+|\.)[#\w\.]+|(\+|-)?[\d]+(%|px|em|deg))/g, '"$1"');
                    e = $.parseJSON(n)
                } catch (r) {}
                return e
            };
        $.fn.spiritAnimateTo = function() {
            var t = [].slice.call(arguments),
                e = function() {
                    return _.isString(t[0])
                },
                n = function() {
                    return _.isNumber(t[0])
                };
            return e() ? i.animateToState.apply(this, [t[0], _.isNumber(t[1]) ? t[1] : r.speed, _.isObject(t[2]) ? t[2] : {}]) : n() ? i.animateTo.apply(this, [t[0], _.isObject(t[1]) ? t[1] : {}]) : void $.error("invalid function parameters provided for jQuery.spiritAnimateTo. First param needs to be a state (string) or speed (number)")
        };
        var r = {
                speed: 1
            },
            i = {
                animateToState: function(e, r, a) {
                    return this.each(function() {
                        var s = $(this),
                            o = s.data("spirit-states");
                        if (_.isString(o)) {
                            var u = new t.States,
                                l = n(o);
                            if (0 === _.size(l)) return void s.trigger("spirit_error", {
                                msg: "jQuery.spiritAnimateTo: could not parse states: " + o
                            });
                            _.each(l, function(t, e) {
                                u.add({
                                    name: e,
                                    tweenObj: t
                                }, {
                                    silent: !0
                                })
                            }), s.data("spirit-states", u), o = u
                        }
                        if (o instanceof t.States) {
                            var c = o.where({
                                name: e
                            });
                            if (0 === c.length) return void s.trigger("spirit_error", {
                                msg: "jQuery.spiritAnimateTo: State[" + e + "] not found on element"
                            });
                            var f = _.first(c).get("tweenObj");
                            _.isObject(f) && i.animateTo.apply(this, [r, _.extend(f, a)])
                        } else s.trigger("spirit_error", {
                            msg: "jQuery.spiritAnimateTo: State[" + e + "] not found on element"
                        })
                    })
                },
                animateTo: function(t, n) {
                    var r = function() {
                        var r = $(this);
                        e && e.to(r, t, n)
                    };
                    return this instanceof HTMLElement ? r.call(this) : this.each(r)
                }
            }
    }(),
    function(t) {
        "use strict";
        var e = new(use("spirit.collection").Groups);
        e.on("add remove reset", function() {
            t.groups.length = e.length
        }), t.__internals__ = {
            params: use("spirit.model").TransitionParam.params
        }, t.groups = {
            __internals__: e,
            length: 0,
            add: function(t, n) {
                return e.add(t, n)
            },
            get: function(t) {
                var n = e.where({
                    name: t
                });
                return n.length > 0 ? n[0] : null
            },
            at: function(t) {
                return e.at(t)
            }
        }, t.load = function(t) {
            return e.reset(t)
        }, t.reset = function() {
            return e.reset()
        }, t.toJSON = function() {
            return e.toJSON()
        }
    }(use("spirit", !0));
    var dispatchLoadedEvent = function(t) {
        window.spiritLoaded = !0;
        var e;
        _.isFunction(window.CustomEvent) ? e = new CustomEvent("spirit-loaded", {
            detail: t
        }) : (e = document.createEvent("Event"), e.initEvent("spirit-loaded", !0, !0), e.detail = t), e && window.dispatchEvent(e)
    };
    "function" == typeof define && define.amd ? define(function() {
        var t = context.spirit || {};
        return dispatchLoadedEvent(t), t
    }) : (_.extend(global, context), dispatchLoadedEvent(context.spirit))
}(window);
